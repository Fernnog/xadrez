/* css/main.css */

/* ==========================================================================
   0. VARIÁVEIS GLOBAIS (DESIGN SYSTEM)
   ========================================================================== */
:root {
    /* Cores do Tabuleiro */
    --board-light: #f0d9b5;
    --board-dark: #b58863;
    --board-border: #111827; /* Gray-900 */
    
    /* Cores da Interface */
    --bg-app: #1f2937;       /* Gray-800 */
    --bg-panel: #4b5563;     /* Gray-600 */
    --bg-panel-widget: #374151; /* Gray-700 */
    --border-panel: #374151;
    
    /* Cores de Destaque */
    --highlight-last-move: rgba(250, 204, 21, 0.8);
    --highlight-valid-move: rgba(34, 197, 94, 0.6);

    /* Medidas Rígidas para Estabilidade (P1 & P3) */
    --board-size: 500px;
    --sidebar-width: 320px;
}

/* ==========================================================================
   1. LAYOUT PRINCIPAL (PRIORIDADE 3: GRID ESTÁVEL)
   ========================================================================== */

body { 
    font-family: 'Inter', sans-serif; 
    margin: 0;
    overflow-x: hidden;
}

/* Transformação do container em Grid para travar colunas (P3) */
#gameContainer {
    display: none; /* Controlado pelo JS */
    width: 100%;
    max-width: 1280px;
    margin: 0 auto;
}

@media (min-width: 1024px) {
    #gameContainer {
        display: grid;
        grid-template-columns: var(--board-size) var(--sidebar-width);
        gap: 2rem;
        justify-content: center;
        align-items: start;
    }
}

/* Coluna do Tabuleiro: Proteção Total contra encolhimento (P1) */
.board-column {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    max-width: var(--board-size);
    flex-shrink: 0;
}

/* ==========================================================================
   2. O TABULEIRO E LABELS
   ========================================================================== */

.board-container { 
    position: relative;     
    width: 100%;
    max-width: var(--board-size);
    aspect-ratio: 1 / 1;
    margin-bottom: 2rem;
}

#board { 
    width: 100%; 
    height: 100%;
    display: grid; 
    grid-template-columns: repeat(8, 1fr); 
    grid-template-rows: repeat(8, 1fr); 
    border: 4px solid var(--board-border); 
    border-radius: 0.5rem;
    overflow: hidden;
    z-index: 10; 
    background-color: var(--board-dark);
}

.square { 
    position: relative; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
}
.light { background-color: var(--board-light); }
.dark { background-color: var(--board-dark); }
.selected-square { background-color: var(--highlight-last-move) !important; }

.valid-move-marker { 
    position: absolute; 
    top: 50%; left: 50%; 
    transform: translate(-50%, -50%); 
    width: 30%; height: 30%; 
    background-color: var(--highlight-valid-move); 
    border-radius: 50%; 
    pointer-events: none; 
    z-index: 5; 
}

/* Labels com Numerais Tabulares para evitar tremulação (P2) */
.rank-labels, .file-labels { 
    position: absolute;
    font-weight: 700; 
    color: #9ca3af; 
    user-select: none;
    font-variant-numeric: tabular-nums;
}

.rank-labels { 
    left: -1.75rem; top: 0; width: 1.5rem; height: 100%; 
    display: grid; grid-template-rows: repeat(8, 1fr); align-items: center;
}

.file-labels { 
    bottom: -1.75rem; left: 0; width: 100%; height: 1.5rem; 
    display: grid; grid-template-columns: repeat(8, 1fr); align-items: center;
}

.rank-labels span, .file-labels span { 
    display: flex; align-items: center; justify-content: center; 
    font-size: 0.875rem; transition: all 0.2s ease;
}

.label-highlight {
    color: #fbbf24 !important; 
    font-weight: 800;
    transform: scale(1.3);
    text-shadow: 0 0 8px rgba(251, 191, 36, 0.4);
}

/* ==========================================================================
   3. PEÇAS (SVG & PERFORMANCE)
   ========================================================================== */

.piece { 
    font-size: 0; 
    width: 100%; height: 100%;
    background-position: center;
    background-repeat: no-repeat;
    background-size: contain; 
    cursor: pointer; 
    user-select: none; 
    z-index: 10; 
    transition: transform 0.1s ease-in-out;
    filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2));
}

.board-flipped { transform: rotate(180deg); }
.board-flipped .piece { transform: rotate(180deg); }

/* ==========================================================================
   4. ESTABILIZAÇÃO DE UI (PRIORIDADE 2: ALTURAS FIXAS)
   ========================================================================== */

/* Fixando altura do Header de Status para evitar pulo no tabuleiro (P2) */
#mainHeader {
    height: 4.5rem; /* h-18 fixo */
    margin-bottom: 1.5rem;
    contain: layout; /* Isola a renderização (P1) */
}

#status {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Prateleira de Capturas com Altura Rígida (P2) */
.captured-pieces-container { 
    display: flex; 
    align-items: center; 
    min-height: 2.5rem; 
    max-height: 2.5rem;
    padding: 0 0.5rem; 
    background-color: var(--bg-panel); 
    border: 1px solid var(--border-panel); 
    border-radius: 0.375rem;
    overflow: hidden;
    width: 100%;
    box-sizing: border-box;
    contain: layout; /* Proteção de layout (P1) */
}

.captured-pieces-container .piece { 
    width: clamp(1rem, 3.5vmin, 1.6rem);
    height: clamp(1rem, 3.5vmin, 1.6rem);
    margin-right: -2px; 
    animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

@keyframes popIn {
    0% { transform: scale(0); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
}

.material-diff { 
    margin-left: auto;
    background-color: rgba(0,0,0,0.4);
    padding: 0.1rem 0.5rem;
    border-radius: 4px;
    font-size: 0.7rem; font-weight: 700;
}

/* Histórico de Lances Estabilizado */
.move-history { 
    height: 24rem; /* h-96 */
    overflow-y: auto;
    scrollbar-width: thin;
    contain: content; /* Máxima isolação de performance (P1) */
}

.move-list-item { 
    display: grid; grid-template-columns: 2.5rem 1fr 1fr; gap: 0.5rem; 
    padding: 0.35rem 0.75rem; 
    font-variant-numeric: tabular-nums;
}
.move-list-item:nth-child(odd) { background-color: rgba(255,255,255,0.05); }
.move-number { color: #9ca3af; text-align: right; margin-right: 0.5rem; }

/* ==========================================================================
   5. MODAIS E UTILITÁRIOS
   ========================================================================== */

.toast { 
    transform: translateX(100%); 
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
    opacity: 0; 
}
.toast-visible { transform: translateX(0); opacity: 1; }

.btn-play-white { background-color: var(--board-dark); color: white; border: 2px solid transparent; }
.btn-play-white:hover { border-color: white; }
.btn-play-black { background-color: var(--board-light); color: #111827; border: 2px solid transparent; }
.btn-play-black:hover { border-color: #111827; }

/* ==========================================================================
   6. MODO WIDGET (POP-OUT)
   ========================================================================== */

body.widget-mode {
    padding: 0 !important;
    overflow: hidden;
    background-color: var(--bg-app);
}

body.widget-mode #gameContainer {
    display: flex !important;
    grid-template-columns: none;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

body.widget-mode .board-column {
    max-width: 90vmin;
}

body.widget-mode .board-container {
    width: 85vmin;
    margin-bottom: 2.5rem; /* Espaço para labels */
}

body.widget-mode .rank-labels { left: -2rem; }
body.widget-mode .file-labels { bottom: -2rem; }

body.widget-mode #mainHeader, 
body.widget-mode #sidebarPanel,
body.widget-mode #popOutWidgetBtn {
    display: none !important;
}
